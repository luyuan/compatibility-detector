# 关键问题及解决方案 #


## 如何拦截对方法和属性的访问 ##

在对 `JavaScript` 进行检测的时候，我们使用了动态检测的方式，只检测运行到的代码是否有潜在的兼容性问题。为此，我们拦截了对一些 DOM 方法和属性的访问。

拦截的办法就是使用“**钩子**”。也就是改写 DOM 原生的方法和属性，拦截对它们的调用，获取调用参数，再调用原始的实现，获取返回值，以此作为判断兼容性问题的依据。


## 如何获取样式的定义值 ##

在检测过程中，程序会扫描整个文档树，检测每一个元素的 CSS 样式。但是通过 getComputedStyle 取到的是样式的计算值，而有时我们需要根据样式的定义值进行判断。

通过 Element.style 可以取到内联的样式定义值，而样式表中的样式定义值可以通过 `WebKit` 内核的专有方法 `window.getMatchedCSSRules` 来取得。


## 如何获得跨域定义的样式表 ##

使用 `window.getMatchedCSSRules` 还有一个问题，就是仍然不能获取到跨域样式表文件中定义的样式。

为此我们利用 Chrome 扩展可以进行跨域访问的特点，通过扩展的后台页面获取跨域定义的样式表文件，将其内容作为一个 STYLE 元素插入到网页中，将跨域的样式表转换为了不跨域的样式表。


## 如何判断一个问题是否有可见的视觉差异 ##

有时候，我们需要根据一个问题是否会在不同的浏览器中产生可见的视觉差异来判断这是否是一个问题，但是我们无法获得一个网页在 IE 等其它浏览器中的渲染效果。

我们采用模拟其它浏览器的办法来解决这个问题，修改特定元素的样式，使之达到与其它浏览器中相同的显示效果，然后来检查是否引起了页面布局的显著差异。


## 如何检测 CSS Hack ##

为了兼容 IE6/7 等特定浏览器，一些网页作者使用了 CSS Hack 的方法，编写了一些不符合标准定义的样式表内容，它们能够被特定的浏览器解析和识别，而别的浏览器会忽略这些不符合标准的样式内容。

目前检测工具中还没有对 CSS Hack 的检测。检测工具目前使用的是 Chrome 浏览器解析之后的样式表定义，因此所有的 CSS Hack 都已经被自动忽略了。

要解决这个问题，必须编写一个自定义的 CSS 解析器。目前还没有实现。